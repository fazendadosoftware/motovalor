<template>
  <div
    class="relative"
    :class="{
      [containerClasses]: !!containerClasses,
      'animate-pulse': typeof vehicleTypeId !== 'number',
      'cursor-pointer': typeof callback === 'function'
    }"
    @click="typeof callback === 'function' ? callback(vehicleTypeId) : undefined"
    @mouseover="hovered = true"
    @mouseleave="hovered = false">
    <span
      v-if="clearable && hovered"
      class="absolute top-0 right-0 text-gray-600 hover:bg-gray-300 hover:text-gray-700 bg-white rounded-full transition-colors cursor-pointer"
      @click="$emit('clear')">
      <svg
        class="w-3.5 h-3.5"
        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </span>
    <svg
      :class="`${svgClasses} ${loading ? 'text-gray-300 animate-pulse' : ''}`"
      viewBox="0 0 60 60"
      fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="30" cy="30" r="30" :fill="loading ? 'currentColor' : _backgroundColor" />
      <template v-if="!loading">
        <!-- truck -->
        <path v-if="vehicleTypeId === 3" d="M37.1429 39.7143C37.1429 38.9405 37.4256 38.2708 37.9911 37.7054C38.5565 37.1399 39.2262 36.8571 40 36.8571C40.7738 36.8571 41.4435 37.1399 42.0089 37.7054C42.5744 38.2708 42.8571 38.9405 42.8571 39.7143C42.8571 40.4881 42.5744 41.1577 42.0089 41.7232C41.4435 42.2887 40.7738 42.5714 40 42.5714C39.2262 42.5714 38.5565 42.2887 37.9911 41.7232C37.4256 41.1577 37.1429 40.4881 37.1429 39.7143ZM45.7143 28.2857H37.1429V22.5714H40.6696C40.8631 22.5714 41.0268 22.6384 41.1607 22.7723L45.5134 27.125C45.6473 27.2589 45.7143 27.4226 45.7143 27.6161V28.2857ZM17.1429 39.7143C17.1429 38.9405 17.4256 38.2708 17.9911 37.7054C18.5565 37.1399 19.2262 36.8571 20 36.8571C20.7738 36.8571 21.4435 37.1399 22.0089 37.7054C22.5744 38.2708 22.8571 38.9405 22.8571 39.7143C22.8571 40.4881 22.5744 41.1577 22.0089 41.7232C21.4435 42.2887 20.7738 42.5714 20 42.5714C19.2262 42.5714 18.5565 42.2887 17.9911 41.7232C17.4256 41.1577 17.1429 40.4881 17.1429 39.7143ZM11.4286 15.4286V38.2857C11.4286 38.5089 11.4583 38.7061 11.5179 38.8772C11.5774 39.0484 11.6778 39.186 11.8192 39.2902C11.9606 39.3943 12.0833 39.4799 12.1875 39.5469C12.2917 39.6138 12.4665 39.6585 12.7121 39.6808C12.9576 39.7031 13.125 39.718 13.2143 39.7254C13.3036 39.7329 13.4933 39.7329 13.7835 39.7254C14.0737 39.718 14.2411 39.7143 14.2857 39.7143C14.2857 41.2917 14.8438 42.6384 15.9598 43.7545C17.0759 44.8705 18.4226 45.4286 20 45.4286C21.5774 45.4286 22.9241 44.8705 24.0402 43.7545C25.1562 42.6384 25.7143 41.2917 25.7143 39.7143H34.2857C34.2857 41.2917 34.8438 42.6384 35.9598 43.7545C37.0759 44.8705 38.4226 45.4286 40 45.4286C41.5774 45.4286 42.9241 44.8705 44.0402 43.7545C45.1562 42.6384 45.7143 41.2917 45.7143 39.7143H47.1429C47.1875 39.7143 47.3549 39.718 47.6451 39.7254C47.9353 39.7329 48.125 39.7329 48.2143 39.7254C48.3036 39.718 48.471 39.7031 48.7165 39.6808C48.9621 39.6585 49.1369 39.6138 49.2411 39.5469C49.3452 39.4799 49.468 39.3943 49.6094 39.2902C49.7507 39.186 49.8512 39.0484 49.9107 38.8772C49.9702 38.7061 50 38.5089 50 38.2857C50 37.8988 49.8586 37.564 49.5759 37.2812C49.2932 36.9985 48.9583 36.8571 48.5714 36.8571V29.7143C48.5714 29.5952 48.5751 29.3348 48.5826 28.933C48.59 28.5312 48.59 28.2485 48.5826 28.0848C48.5751 27.9211 48.5565 27.6644 48.5268 27.3147C48.497 26.965 48.4487 26.6897 48.3817 26.4888C48.3147 26.2879 48.2106 26.061 48.0692 25.808C47.9278 25.5551 47.7604 25.3318 47.567 25.1384L43.1473 20.7187C42.8646 20.436 42.4888 20.1979 42.0201 20.0045C41.5513 19.811 41.1161 19.7143 40.7143 19.7143H37.1429V15.4286C37.1429 15.0417 37.0015 14.7068 36.7188 14.4241C36.436 14.1414 36.1012 14 35.7143 14H12.8571C12.4702 14 12.1354 14.1414 11.8527 14.4241C11.5699 14.7068 11.4286 15.0417 11.4286 15.4286Z" :fill="_textColor" />
        <!-- car -->
        <path v-if="vehicleTypeId === 1" d="M19.375 32.8571C19.375 31.9929 19.069 31.253 18.457 30.6375C17.8451 30.022 17.1094 29.7143 16.25 29.7143C15.3906 29.7143 14.6549 30.022 14.043 30.6375C13.431 31.253 13.125 31.9929 13.125 32.8571C13.125 33.7214 13.431 34.4613 14.043 35.0768C14.6549 35.6923 15.3906 36 16.25 36C17.1094 36 17.8451 35.6923 18.457 35.0768C19.069 34.4613 19.375 33.7214 19.375 32.8571ZM20.0781 26.5714H39.9219L38.1836 19.5589C38.1576 19.4542 38.0664 19.3396 37.9102 19.2152C37.7539 19.0908 37.6172 19.0286 37.5 19.0286H22.5C22.3828 19.0286 22.2461 19.0908 22.0898 19.2152C21.9336 19.3396 21.8424 19.4542 21.8164 19.5589L20.0781 26.5714ZM46.875 32.8571C46.875 31.9929 46.569 31.253 45.957 30.6375C45.3451 30.022 44.6094 29.7143 43.75 29.7143C42.8906 29.7143 42.1549 30.022 41.543 30.6375C40.931 31.253 40.625 31.9929 40.625 32.8571C40.625 33.7214 40.931 34.4613 41.543 35.0768C42.1549 35.6923 42.8906 36 43.75 36C44.6094 36 45.3451 35.6923 45.957 35.0768C46.569 34.4613 46.875 33.7214 46.875 32.8571ZM50 30.9714V38.5143C50 38.6976 49.9414 38.8482 49.8242 38.9661C49.707 39.0839 49.5573 39.1429 49.375 39.1429H47.5V41.6571C47.5 42.7048 47.1354 43.5952 46.4062 44.3286C45.6771 45.0619 44.7917 45.4286 43.75 45.4286C42.7083 45.4286 41.8229 45.0619 41.0938 44.3286C40.3646 43.5952 40 42.7048 40 41.6571V39.1429H20V41.6571C20 42.7048 19.6354 43.5952 18.9062 44.3286C18.1771 45.0619 17.2917 45.4286 16.25 45.4286C15.2083 45.4286 14.3229 45.0619 13.5938 44.3286C12.8646 43.5952 12.5 42.7048 12.5 41.6571V39.1429H10.625C10.4427 39.1429 10.293 39.0839 10.1758 38.9661C10.0586 38.8482 10 38.6976 10 38.5143V30.9714C10 29.7536 10.4264 28.7158 11.2793 27.858C12.1322 27.0003 13.1641 26.5714 14.375 26.5714H14.9219L16.9727 18.3411C17.2721 17.1101 17.9492 16.0789 19.0039 15.2473C20.0586 14.4158 21.224 14 22.5 14H37.5C38.776 14 39.9414 14.4158 40.9961 15.2473C42.0508 16.0789 42.7279 17.1101 43.0273 18.3411L45.0781 26.5714H45.625C46.8359 26.5714 47.8678 27.0003 48.7207 27.858C49.5736 28.7158 50 29.7536 50 30.9714Z" :fill="_textColor" />
        <!-- motorcycle -->
        <path v-if="vehicleTypeId === 2" d="M49.9457 32.5407C50.0845 33.7328 49.9572 34.8814 49.5637 35.9867C49.1702 37.0919 48.5974 38.038 47.8451 38.825C47.0928 39.612 46.1756 40.2254 45.0935 40.6652C44.0114 41.1049 42.8743 41.2843 41.6822 41.2033C39.8189 41.076 38.2015 40.3527 36.8301 39.0333C35.4586 37.714 34.6803 36.1284 34.4951 34.2767C34.3563 32.9921 34.5154 31.774 34.9725 30.6225C35.4297 29.4709 36.1154 28.4843 37.0297 27.6626L35.7971 25.8051C34.6861 26.7309 33.8123 27.8536 33.1758 29.1729C32.5392 30.4923 32.221 31.9042 32.221 33.4087C32.221 33.7212 32.1139 33.9903 31.8998 34.216C31.6857 34.4416 31.4224 34.5545 31.1099 34.5545H25.4679C25.2017 36.4525 24.3395 38.038 22.8812 39.3111C21.423 40.5841 19.7217 41.2207 17.7773 41.2207C15.6363 41.2207 13.8048 40.4597 12.2829 38.9379C10.761 37.416 10 35.5845 10 33.4434C10 31.3024 10.761 29.4709 12.2829 27.949C13.8048 26.4271 15.6363 25.6662 17.7773 25.6662C18.6569 25.6662 19.5365 25.8224 20.4161 26.1349L20.8327 25.3537C19.4092 24.0807 17.65 23.4441 15.5552 23.4441H14.4442C14.1433 23.4441 13.8829 23.3342 13.663 23.1143C13.4431 22.8944 13.3331 22.634 13.3331 22.3331C13.3331 22.0322 13.4431 21.7718 13.663 21.5519C13.8829 21.332 14.1433 21.2221 14.4442 21.2221H16.6663C17.569 21.2221 18.4081 21.3002 19.1835 21.4564C19.9589 21.6127 20.6331 21.8355 21.206 22.1248C21.7788 22.4141 22.1926 22.6427 22.4472 22.8105C22.7018 22.9783 22.9969 23.1895 23.3326 23.4441H34.2174L32.7418 21.2221H28.8878C28.5406 21.2221 28.2571 21.0919 28.0372 20.8315C27.8173 20.5711 27.7363 20.2673 27.7941 19.9201C27.8404 19.6539 27.9735 19.434 28.1934 19.2604C28.4133 19.0868 28.6621 19 28.9399 19H33.332C33.7139 19 34.0206 19.162 34.2521 19.4861L35.4673 21.3089L37.4464 19.3298C37.6663 19.1099 37.9324 19 38.2449 19H39.9983C40.2992 19 40.5596 19.1099 40.7795 19.3298C40.9994 19.5497 41.1094 19.8101 41.1094 20.111V22.3331C41.1094 22.634 40.9994 22.8944 40.7795 23.1143C40.5596 23.3342 40.2992 23.4441 39.9983 23.4441H36.8908L38.8873 26.43C40.4034 25.7009 41.9947 25.4926 43.6613 25.8051C45.3163 26.106 46.7282 26.8843 47.8972 28.14C49.0661 29.3957 49.7489 30.8626 49.9457 32.5407ZM17.7773 38.9986C19.1083 38.9986 20.283 38.5791 21.3014 37.74C22.3199 36.901 22.9622 35.8391 23.2284 34.5545H17.7773C17.3723 34.5545 17.054 34.3751 16.8225 34.0163C16.6142 33.646 16.6084 33.2814 16.8052 32.9226L19.3571 28.114C18.8132 27.9635 18.2866 27.8883 17.7773 27.8883C16.2496 27.8883 14.9419 28.4322 13.8539 29.5201C12.766 30.608 12.2221 31.9158 12.2221 33.4434C12.2221 34.9711 12.766 36.2789 13.8539 37.3668C14.9419 38.4547 16.2496 38.9986 17.7773 38.9986ZM42.2204 38.9986C43.7481 38.9986 45.0559 38.4547 46.1438 37.3668C47.2317 36.2789 47.7756 34.9711 47.7756 33.4434C47.7756 31.9158 47.2317 30.608 46.1438 29.5201C45.0559 28.4322 43.7481 27.8883 42.2204 27.8883C41.526 27.8883 40.8258 28.0272 40.1198 28.3049L43.1405 32.8185C43.3141 33.0847 43.372 33.3682 43.3141 33.6691C43.2562 33.97 43.1 34.2015 42.8454 34.3635C42.6718 34.4908 42.4634 34.5545 42.2204 34.5545C41.8153 34.5545 41.5086 34.3867 41.3003 34.051L38.2797 29.5375C37.2033 30.6369 36.6652 31.9389 36.6652 33.4434C36.6652 34.9711 37.2091 36.2789 38.297 37.3668C39.3849 38.4547 40.6927 38.9986 42.2204 38.9986Z" :fill="_textColor" />
      </template>
    </svg>
  </div>
</template>

<script lang="ts" setup>
import { ref, unref, toRefs, computed } from 'vue'

const props = defineProps({
  vehicleTypeId: { type: Number, required: true },
  backgroundColor: { type: String, required: false },
  textColor: { type: String, required: false },
  loading: { type: Boolean, required: false },
  containerClasses: { type: String, required: false, default: '' },
  svgClasses: { type: String, required: false },
  callback: { type: Function, required: false },
  clearable: { type: Boolean, required: false }
})
const { vehicleTypeId, backgroundColor, textColor, loading, containerClasses, svgClasses, callback, clearable } = toRefs(props)
const hovered = ref(false)

const _textColor = computed(() => {
  if (unref(textColor)) return unref(textColor)
  const textColors = ['white', 'white', 'white']
  return textColors[unref(vehicleTypeId) - 1]
})

const _backgroundColor = computed(() => {
  if (unref(backgroundColor)) return unref(backgroundColor)
  const backgroundColors = ['#38A169', '#D53F8C', '#D69E2E']
  return backgroundColors[unref(vehicleTypeId) - 1]
})
</script>
